initial_state: 'on'
alias: 'Alarm armed trigger'
trigger:
  - platform: state
    entity_id:
      - binary_sensor.vestibule_window_front
      - binary_sensor.vestibule_window_side
      - binary_sensor.patio_door_left_sensor
      - binary_sensor.utility_door_exterior_sensor
      - binary_sensor.garage_closed_bike_sensor
      - binary_sensor.garage_closed_car_sensor
      - binary_sensor.guest_bedroom_window_left
      - binary_sensor.guest_bedroom_window_right
      - binary_sensor.master_window_left
      - binary_sensor.master_window_right
      - binary_sensor.master_window_ensuite
      - binary_sensor.office_window
      - binary_sensor.spare_bedroom_window_left
      - binary_sensor.spare_bedroom_window_right
      - binary_sensor.second_bedroom_window_ensuite
      - binary_sensor.second_bedroom_window_left
      - binary_sensor.second_bedroom_window_right
      - binary_sensor.bathroom_window
    to: 'on'
condition:
  # Alarm is armed
  - condition: state
    entity_id: alarm_control_panel.ha_alarm
    state: armed_away
  # Nobody's home
  - condition: or
    conditions:
    - condition: state
      entity_id: input_boolean.home_occupied
      state: 'off'
    - condition: state
      entity_id: input_boolean.all_away
      state: 'on'
action:
  - service: alarm_control_panel.alarm_trigger
    entity_id: alarm_control_panel.ha_alarm
