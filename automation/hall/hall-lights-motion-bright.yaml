initial_state: 'on'
alias: 'Hall lights motion bright'
trigger:
  - platform: state
    entity_id: binary_sensor.hall_downstairs_occupancy
    to: 'on'
condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.lighting_automations
      state: 'on'
    - condition: or
      conditions:
      - condition: and
        conditions:
        # And the hall light is on and dim
        - condition: state
          entity_id: light.hall
          state: 'on'
        - condition: numeric_state
          entity_id: light.hall
          value_template: "{{ state_attr('light.hall','brightness') }}"
          below: 10
      - condition: and
        conditions:
        # Hall light is off, light levels are generally low
        - condition: state
          entity_id: light.hall
          state: 'off'
        - condition: numeric_state
          entity_id: sensor.hall_downstairs_illuminance
          below: 1
        - condition: numeric_state
          entity_id: sensor.living_room_multi_luminance
          below: 20
        - condition: state
          entity_id: input_boolean.bedtime
          state: 'off'
        # Home or guest mode
        - condition: or
          conditions:
          - condition: state
            entity_id: input_boolean.all_away
            state: 'off'
          - condition: state
            entity_id: input_boolean.guest_mode
            state: 'on'
action:
  - service: switch.turn_on
    entity_id: switch.circadian_lighting_circadian_hall
  - service: light.turn_on
    data:
      entity_id: light.hall
      brightness_pct: 6
      transition: 5
      kelvin: "{{ state_attr('sensor.circadian_values','colortemp')|round }}"
